services:
  dashboard:
    build:
      context: ./projects/dashboard
      args:
        NEXT_PUBLIC_USE_MOCK: "${NEXT_PUBLIC_USE_MOCK:-true}"
        NEXT_PUBLIC_HEDERA_TOPIC_IDS: "${NEXT_PUBLIC_HEDERA_TOPIC_IDS:-}"
        NEXT_PUBLIC_HEDERA_MIRROR_NODE_URL: "${NEXT_PUBLIC_HEDERA_MIRROR_NODE_URL:-https://testnet.mirrornode.hedera.com}"
        NEXT_PUBLIC_HUB_WS_URL: "${NEXT_PUBLIC_HUB_WS_URL:-ws://coordinator:8080/ws}"
    ports:
      - "3000:3000"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:3000"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 15s

  coordinator:
    build:
      context: ./projects/agent-coordinator
    environment:
      HEDERA_COORDINATOR_ACCOUNT_ID: "${HEDERA_COORDINATOR_ACCOUNT_ID:-}"
      HEDERA_COORDINATOR_PRIVATE_KEY: "${HEDERA_COORDINATOR_PRIVATE_KEY:-}"
      HEDERA_AGENT1_ACCOUNT_ID: "${HEDERA_AGENT1_ACCOUNT_ID:-}"
      HEDERA_AGENT2_ACCOUNT_ID: "${HEDERA_AGENT2_ACCOUNT_ID:-}"
      HCS_TASK_TOPIC_ID: "${HCS_TASK_TOPIC_ID:-}"
      HCS_STATUS_TOPIC_ID: "${HCS_STATUS_TOPIC_ID:-}"
      HTS_PAYMENT_TOKEN_ID: "${HTS_PAYMENT_TOKEN_ID:-}"
      DAEMON_ADDRESS: "host.docker.internal:50051"
    profiles: [agents]
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
    healthcheck:
      test: ["CMD", "pgrep", "-x", "coordinator"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s

  inference:
    build:
      context: ./projects/agent-inference
    environment:
      HEDERA_ACCOUNT_ID: "${INFERENCE_HEDERA_ACCOUNT_ID:-}"
      HEDERA_PRIVATE_KEY: "${INFERENCE_HEDERA_PRIVATE_KEY:-}"
      INFERENCE_AGENT_ID: "${INFERENCE_AGENT_ID:-inference-001}"
      INFERENCE_DAEMON_ADDR: "host.docker.internal:9090"
      HCS_TASK_TOPIC: "${HCS_TASK_TOPIC:-}"
      HCS_RESULT_TOPIC: "${HCS_RESULT_TOPIC:-}"
      ZG_CHAIN_RPC: "${ZG_CHAIN_RPC:-https://evmrpc-testnet.0g.ai}"
      ZG_CHAIN_PRIVATE_KEY: "${ZG_CHAIN_PRIVATE_KEY:-}"
      ZG_SERVING_CONTRACT: "${ZG_SERVING_CONTRACT:-}"
      ZG_COMPUTE_ENDPOINT: "${ZG_COMPUTE_ENDPOINT:-}"
      ZG_FLOW_CONTRACT: "${ZG_FLOW_CONTRACT:-0x22E03a6A89B950F1c82ec5e74F8eCa321a105296}"
      ZG_STORAGE_NODE_ENDPOINT: "${ZG_STORAGE_NODE_ENDPOINT:-}"
      ZG_STORAGE_ENDPOINT: "${ZG_STORAGE_ENDPOINT:-}"
      ZG_INFT_CONTRACT: "${ZG_INFT_CONTRACT:-}"
      ZG_ENCRYPTION_KEY: "${ZG_ENCRYPTION_KEY:-}"
      ZG_ENCRYPTION_KEY_ID: "${ZG_ENCRYPTION_KEY_ID:-default}"
      ZG_DA_CONTRACT: "${ZG_DA_CONTRACT:-0xE75A073dA5bb7b0eC622170Fd268f35E675a957B}"
      ZG_DA_NAMESPACE: "${ZG_DA_NAMESPACE:-inference-audit}"
      ZG_DA_ENDPOINT: "${ZG_DA_ENDPOINT:-}"
    profiles: [agents]
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
    healthcheck:
      test: ["CMD", "pgrep", "-x", "agent-inference"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s

  defi:
    build:
      context: ./projects/agent-defi
    environment:
      HEDERA_ACCOUNT_ID: "${DEFI_HEDERA_ACCOUNT_ID:-}"
      HEDERA_PRIVATE_KEY: "${DEFI_HEDERA_PRIVATE_KEY:-}"
      DEFI_AGENT_ID: "${DEFI_AGENT_ID:-defi-001}"
      DEFI_DAEMON_ADDR: "host.docker.internal:9090"
      HCS_TASK_TOPIC: "${DEFI_HCS_TASK_TOPIC:-}"
      HCS_RESULT_TOPIC: "${DEFI_HCS_RESULT_TOPIC:-}"
      DEFI_BASE_RPC_URL: "${DEFI_BASE_RPC_URL:-https://sepolia.base.org}"
      DEFI_PRIVATE_KEY: "${DEFI_PRIVATE_KEY:-}"
      DEFI_WALLET_ADDRESS: "${DEFI_WALLET_ADDRESS:-}"
      DEFI_ERC8004_CONTRACT: "${DEFI_ERC8004_CONTRACT:-}"
      DEFI_DEX_ROUTER: "${DEFI_DEX_ROUTER:-}"
      DEFI_BUILDER_CODE: "${DEFI_BUILDER_CODE:-}"
      DEFI_ATTRIBUTION_ENABLED: "${DEFI_ATTRIBUTION_ENABLED:-true}"
      DEFI_TOKEN_IN: "${DEFI_TOKEN_IN:-0x036CbD53842c5426634e7929541eC2318f3dCF7e}"
      DEFI_TOKEN_OUT: "${DEFI_TOKEN_OUT:-0x4200000000000000000000000000000000000006}"
    profiles: [agents]
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
    healthcheck:
      test: ["CMD", "pgrep", "-x", "agent-defi"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s
